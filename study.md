
# è§£é‡Šè¿™ä¸ªé¡¹ç›®, å¸®åŠ©æˆ‘å¿«é€Ÿä¸Šæ‰‹

æˆ‘æ¥å¸®ä½ å¿«é€Ÿäº†è§£è¿™ä¸ªé¡¹ç›®ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹é¡¹ç›®ç»“æ„å’Œå…³é”®æ–‡ä»¶æ¥ä¸ºä½ æä¾›å…¨é¢çš„ä»‹ç»ã€‚

âº Update Todos
  â¿  â˜ æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ç»“æ„        
     â˜ é˜…è¯»READMEæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è¿°
     â˜ æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œä¾èµ–
     â˜ æŸ¥çœ‹ä¸»è¦ä»£ç ç»“æ„
     â˜ äº†è§£APIæ¥å£è®¾è®¡

âº Update Todos
  â¿  â˜ æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ç»“æ„        
     â˜ é˜…è¯»READMEæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è¿°
     â˜ æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œä¾èµ–
     â˜ æŸ¥çœ‹ä¸»è¦ä»£ç ç»“æ„
     â˜ äº†è§£APIæ¥å£è®¾è®¡

âº List(.)
  â¿  Listed 820 paths (ctrl+r to expand)

âº Read(README.md)
  â¿  Read 91 lines (ctrl+r to expand)

âº Read(study.md)
  â¿  Error: File does not exist.

âº Update Todos
  â¿  â˜’ æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ç»“æ„        
     â˜ é˜…è¯»READMEæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è¿°
     â˜ æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œä¾èµ–
     â˜ æŸ¥çœ‹ä¸»è¦ä»£ç ç»“æ„
     â˜ äº†è§£APIæ¥å£è®¾è®¡

âº Read(go.mod)
  â¿  Read 149 lines (ctrl+r to expand)

âº Read(Makefile)
  â¿  Read 50 lines (ctrl+r to expand)

âº Update Todos
  â¿  â˜’ æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ç»“æ„        
     â˜’ é˜…è¯»READMEæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è¿°
     â˜’ æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œä¾èµ–
     â˜ æŸ¥çœ‹ä¸»è¦ä»£ç ç»“æ„
     â˜ äº†è§£APIæ¥å£è®¾è®¡

âº Read(cmd)
  â¿  Error: EISDIR: illegal operation on a directory, read

âº List(internal)
  â¿  Listed 334 paths (ctrl+r to expand)

âº Read(docs/guide/zh-CN/installation/installation-architecture.md)
  â¿  Read 30 lines (ctrl+r to expand)

âº Update Todos
  â¿  â˜’ æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•ç»“æ„        
     â˜’ é˜…è¯»READMEæ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è¿°
     â˜’ æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œä¾èµ–
     â˜’ æŸ¥çœ‹ä¸»è¦ä»£ç ç»“æ„
     â˜’ äº†è§£APIæ¥å£è®¾è®¡

âº IAM - èº«ä»½è¯†åˆ«ä¸è®¿é—®ç®¡ç†ç³»ç»Ÿå¿«é€Ÿä¸Šæ‰‹æŒ‡å—

  é¡¹ç›®æ¦‚è§ˆ

  IAM (Identity and Access Management)
  æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€å¼€å‘çš„ä¼ä¸šçº§èº«ä»½è¯†åˆ«ä¸è®¿é—®ç®¡ç†ç³»ç»Ÿï¼Œå½“å‰ç¨³å®šç‰ˆæœ¬ä¸º v1.6.2ã€‚

  æ ¸å¿ƒæ¶æ„

  ä¸»è¦ç»„ä»¶

  - iam-apiserver - æ ¸å¿ƒAPIæœåŠ¡å™¨ï¼Œæä¾›ç”¨æˆ·ã€å¯†é’¥å’Œç­–ç•¥çš„RESTful API
  - iam-authz-server - æˆæƒæœåŠ¡å™¨ï¼Œå¤„ç†èµ„æºè®¿é—®æˆæƒè¯·æ±‚
  - iam-pump - æ•°æ®å¤„ç†æœåŠ¡ï¼Œåˆ†ææˆæƒæ—¥å¿—å­˜å‚¨åˆ°MongoDB
  - iam-watcher - å®šæ—¶ä»»åŠ¡æœåŠ¡ï¼Œå¤„ç†æ•°æ®æ¸…ç†å’Œç”¨æˆ·ç®¡ç†
  - iamctl - å‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·

  æŠ€æœ¯æ ˆ

  - è¯­è¨€: Go 1.21.4
  - Webæ¡†æ¶: Gin
  - æ•°æ®åº“: MySQL (ä¸»å­˜å‚¨) + Redis (ç¼“å­˜) + MongoDB (æ—¥å¿—)
  - è®¤è¯: JWT + Basic Auth
  - API: RESTful + gRPC

  å¿«é€Ÿå¼€å§‹

  1. ç¯å¢ƒè¦æ±‚

  - CentOS Linux 8.x (æ¨è)
  - Go 1.21.4+
  - æœåŠ¡å™¨éœ€è¦è®¿é—®å¤–ç½‘

  2. æ„å»ºé¡¹ç›®

  # å…‹éš†ä»£ç 
  git clone https://github.com/marmotedu/iam $GOPATH/src/github.com/marmotedu/iam

  # ç¼–è¯‘
  cd $GOPATH/src/github.com/marmotedu/iam
  make

  3. éƒ¨ç½²

  å‚è€ƒæ–‡æ¡£ï¼šdocs/guide/zh-CN/installation/README.md

  é¡¹ç›®ç»“æ„

  iam/
  â”œâ”€â”€ cmd/                 # ä¸»ç¨‹åºå…¥å£
  â”‚   â”œâ”€â”€ iam-apiserver/   # APIæœåŠ¡å™¨
  â”‚   â”œâ”€â”€ iam-authz-server/# æˆæƒæœåŠ¡å™¨
  â”‚   â”œâ”€â”€ iam-pump/        # æ•°æ®å¤„ç†æœåŠ¡
  â”‚   â”œâ”€â”€ iam-watcher/     # å®šæ—¶ä»»åŠ¡æœåŠ¡
  â”‚   â””â”€â”€ iamctl/          # å‘½ä»¤è¡Œå·¥å…·
  â”œâ”€â”€ internal/            # å†…éƒ¨å®ç°ä»£ç 
  â”‚   â”œâ”€â”€ apiserver/       # APIæœåŠ¡å™¨å®ç°
  â”‚   â”œâ”€â”€ authzserver/     # æˆæƒæœåŠ¡å™¨å®ç°
  â”‚   â”œâ”€â”€ pump/           # æ•°æ®å¤„ç†å®ç°
  â”‚   â”œâ”€â”€ watcher/        # ä»»åŠ¡è°ƒåº¦å®ç°
  â”‚   â””â”€â”€ pkg/            # å†…éƒ¨å…¬å…±åŒ…
  â”œâ”€â”€ pkg/                # å¤–éƒ¨å¯ç”¨åŒ…
  â”œâ”€â”€ configs/            # é…ç½®æ–‡ä»¶
  â”œâ”€â”€ docs/              # æ–‡æ¡£
  â””â”€â”€ scripts/           # è„šæœ¬å·¥å…·

  å¸¸ç”¨å‘½ä»¤

  # ç¼–è¯‘æ‰€æœ‰ç»„ä»¶
  make build

  # è¿è¡Œæµ‹è¯•
  make test

  # ç”Ÿæˆæ–‡æ¡£
  make gen.doc

  # ä»£ç æ ¼å¼åŒ–
  make format

  # ä»£ç æ£€æŸ¥
  make lint

  æ ¸å¿ƒåŠŸèƒ½

  - ç”¨æˆ·èº«ä»½ç®¡ç† (å¢åˆ æ”¹æŸ¥)
  - è®¿é—®å¯†é’¥ç®¡ç†
  - æˆæƒç­–ç•¥ç®¡ç†
  - èµ„æºè®¿é—®æˆæƒ
  - å®¡è®¡æ—¥å¿—è®°å½•
  - åˆ†å¸ƒå¼ç¼“å­˜
  - é«˜å¯ç”¨éƒ¨ç½²

  å­¦ä¹ èµ„æº

  - docs/guide/zh-CN/
  - docs/guide/zh-CN/api/
  - https://time.geekbang.org/column/intro/100079601
  - docs/guide/zh-CN/installation/

  è¿™æ˜¯ä¸€ä¸ªæˆç†Ÿçš„ä¼ä¸šçº§é¡¹ç›®ï¼Œé€‚åˆå­¦ä¹ Goè¯­è¨€ä¼ä¸šå¼€å‘æœ€ä½³å®è·µã€‚

  
# é¡¹ç›®ä¸šåŠ¡æ¶æ„å›¾

 æ¶æ„åˆ†å±‚

  æ¶æ„å›¾åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æµå‘ï¼š
  - æ•°æ®æµï¼ˆå·¦ä¾§ï¼‰ï¼šå¤„ç†æˆæƒè¯·æ±‚å’Œæ—¥å¿—æ•°æ®
  - æ§åˆ¶æµï¼ˆå³ä¾§ï¼‰ï¼šç®¡ç†ç”¨æˆ·ã€ç­–ç•¥å’Œç³»ç»Ÿé…ç½®

  æ ¸å¿ƒç»„ä»¶åŠæ•°æ®æµå‘

  1. ç®¡ç†æ§åˆ¶æµç¨‹
  - iam-webconsoleï¼šWebç®¡ç†æ§åˆ¶å° â†’ RESTful API â†’ iam-apiserver
  - iamctlï¼šå‘½ä»¤è¡Œå·¥å…· â†’ SDK â†’ iam-apiserver
  - iam-operating-systemï¼šè¿è¥ç³»ç»Ÿ â†’ RESTful API â†’ iam-apiserver

  2. æˆæƒæ•°æ®æµç¨‹
  - Appï¼šç¬¬ä¸‰æ–¹åº”ç”¨ â†’ SDK â†’ iam-authz-server (æˆæƒè¯·æ±‚)
  - iam-authz-server â†” Redisï¼šç¼“å­˜ç­–ç•¥å’Œæ—¥å¿—
  - iam-authz-server â† gRPC â† iam-apiserverï¼šæ‹‰å–ç­–ç•¥æ•°æ®

  3. æ•°æ®å¤„ç†æµç¨‹
  - iam-pumpï¼šä»Redisæ‹‰å–æ—¥å¿— â†’ å­˜å‚¨è‡³MongoDB
  - iam-watcherï¼šå®šæ—¶ä»»åŠ¡å¤„ç†MariaDBæ•°æ®æ¸…ç†

  4. æ•°æ®å­˜å‚¨å±‚
  - MariaDBï¼šæŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·ã€å¯†é’¥ã€ç­–ç•¥
  - Redisï¼šç¼“å­˜æˆæƒç­–ç•¥å’Œæ—¥å¿—æ•°æ®
  - MongoDBï¼šå­˜å‚¨åˆ†æåçš„æˆæƒæ—¥å¿—

  å…³é”®ç‰¹æ€§

  - è´Ÿè½½å‡è¡¡ï¼šæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²ï¼Œé€šè¿‡LoadBalanceåˆ†å‘è¯·æ±‚
  - æ•°æ®åˆ†ç¦»ï¼šè¯»å†™åˆ†ç¦»ï¼ŒæˆæƒæœåŠ¡ç‹¬ç«‹ç¼“å­˜æå‡æ€§èƒ½
  - å¼‚æ­¥å¤„ç†ï¼šæ—¥å¿—å¤„ç†å’Œæ•°æ®æ¸…ç†å¼‚æ­¥æ‰§è¡Œ
  - å¤šæ¥å£ï¼šæ”¯æŒRESTful APIã€gRPCã€SDKç­‰å¤šç§è®¿é—®æ–¹å¼

  ä¸šåŠ¡æµç¨‹

  1. ç”¨æˆ·é€šè¿‡Webæ§åˆ¶å°æˆ–å‘½ä»¤è¡Œç®¡ç†èµ„æº
  2. ç¬¬ä¸‰æ–¹åº”ç”¨é€šè¿‡SDKè¯·æ±‚èµ„æºæˆæƒ
  3. æˆæƒæœåŠ¡æŸ¥è¯¢ç¼“å­˜ç­–ç•¥è¿›è¡Œæˆæƒå†³ç­–
  4. æˆæƒæ—¥å¿—å¼‚æ­¥å¤„ç†å’Œå­˜å‚¨
  5. è¿è¥ç³»ç»ŸæŸ¥çœ‹æˆæƒæ•°æ®å’Œç³»ç»Ÿç›‘æ§





```mermaid
graph TB
      %% å®šä¹‰æ ·å¼ç±»
      classDef coreService fill:#e1f5fe,stroke:#01579b,stroke-width:2px
      classDef externalApp fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
      classDef database fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
      classDef client fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
      classDef middleware fill:#fce4ec,stroke:#880e4f,stroke-width:2px

      %% å®¢æˆ·ç«¯å±‚
      subgraph "å®¢æˆ·ç«¯å±‚"
          A[ç¬¬ä¸‰æ–¹åº”ç”¨ App]:::externalApp
          B[Webæ§åˆ¶å° iam-webconsole]:::externalApp
          C[å‘½ä»¤è¡Œå·¥å…· iamctl]:::client
          D[è¿è¥ç³»ç»Ÿ iam-operating-system]:::externalApp
      end

      %% è´Ÿè½½å‡è¡¡å±‚
      LB[è´Ÿè½½å‡è¡¡å™¨ LoadBalance]:::middleware

      %% æ ¸å¿ƒæœåŠ¡å±‚
      subgraph "æ ¸å¿ƒæœåŠ¡å±‚"
          E[APIæœåŠ¡å™¨ iam-apiserver]:::coreService
          F[æˆæƒæœåŠ¡å™¨ iam-authz-server]:::coreService
          G[æ•°æ®å¤„ç†æœåŠ¡ iam-pump]:::coreService
          H[å®šæ—¶ä»»åŠ¡æœåŠ¡ iam-watcher]:::coreService
      end

      %% æ•°æ®å­˜å‚¨å±‚
      subgraph "æ•°æ®å­˜å‚¨å±‚"
          I[(MariaDB<br/>ç”¨æˆ·Â·å¯†é’¥Â·ç­–ç•¥)]:::database
          J[(Redis<br/>ç¼“å­˜Â·æ—¥å¿—)]:::database
          K[(MongoDB<br/>æˆæƒæ—¥å¿—)]:::database
      end

      %% SDK
      SDK[marmotedu-sdk-go]:::client

      %% è¿æ¥å…³ç³» - æ§åˆ¶æµ
      B -->|1. RESTful API| LB
      C -->|1. SDK| E
      D -->|4. RESTful API| E
      LB --> E

      %% è¿æ¥å…³ç³» - æ•°æ®æµ
      A -->|2. SDK æˆæƒè¯·æ±‚| F
      F -->|Sub & Store| J
      F -->|gRPC æ‹‰å–ç­–ç•¥| E

      %% æ•°æ®å¤„ç†æµç¨‹
      G -->|3. æ‹‰å–æ—¥å¿—| J
      G -->|å­˜å‚¨åˆ†ææ—¥å¿—| K

      %% å®šæ—¶ä»»åŠ¡æµç¨‹
      H -->|5. æ•°æ®æ¸…ç†| I

      %% æŒä¹…åŒ–å­˜å‚¨
      E -->|è¯»å†™| I
      F -->|ç¼“å­˜ç­–ç•¥| J

      %% æ·»åŠ æµç¨‹è¯´æ˜
      E -.->|Pub ç­–ç•¥æ›´æ–°| J

```

  æ¶æ„æµç¨‹è¯´æ˜

  ğŸ”„ æ•°æ®æµå‘è¯¦è§£

  1ï¸âƒ£ ç®¡ç†æ§åˆ¶æµ
  - Webæ§åˆ¶å°/è¿è¥ç³»ç»Ÿ â†’ RESTful API â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ iam-apiserver
  - å‘½ä»¤è¡Œå·¥å…· iamctl â†’ SDK â†’ iam-apiserver
  - iam-apiserver â†” MariaDBï¼ˆCRUDæ“ä½œï¼‰

  2ï¸âƒ£ æˆæƒæ•°æ®æµ
  - ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ SDK â†’ iam-authz-serverï¼ˆæˆæƒè¯·æ±‚ï¼‰
  - iam-authz-server â†” Redisï¼ˆç¼“å­˜ç­–ç•¥ã€å­˜å‚¨æ—¥å¿—ï¼‰
  - iam-authz-server â† gRPC â† iam-apiserverï¼ˆåŒæ­¥ç­–ç•¥ï¼‰

  3ï¸âƒ£ æ—¥å¿—å¤„ç†æµ
  - iam-pump â†’ Redisï¼ˆæ‹‰å–æ—¥å¿—ï¼‰â†’ åˆ†æå¤„ç† â†’ MongoDB

  4ï¸âƒ£ å®šæ—¶ç»´æŠ¤æµ
  - iam-watcher â†’ MariaDBï¼ˆæ•°æ®æ¸…ç†ã€ç”¨æˆ·ç®¡ç†ï¼‰

  ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

  | ç‰¹æ€§   | è¯´æ˜                 |
  |------|--------------------|
  | é«˜å¯ç”¨  | è´Ÿè½½å‡è¡¡ + å¤šå®ä¾‹éƒ¨ç½²       |
  | é«˜æ€§èƒ½  | Redisç¼“å­˜ + è¯»å†™åˆ†ç¦»     |
  | å¯æ‰©å±•  | å¾®æœåŠ¡æ¶æ„ï¼Œç»„ä»¶ç‹¬ç«‹         |
  | å¼‚æ­¥å¤„ç† | æ—¥å¿—å’Œæ¸…ç†ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ        |
  | å¤šæ¥å£  | RESTfulã€gRPCã€SDKæ”¯æŒ |

  ğŸ’¾ å­˜å‚¨åˆ†å±‚

  - MariaDB: ä¸»æ•°æ®å­˜å‚¨ï¼ˆç”¨æˆ·ã€å¯†é’¥ã€ç­–ç•¥ï¼‰
  - Redis: é«˜æ€§èƒ½ç¼“å­˜ï¼ˆç­–ç•¥ç¼“å­˜ã€æˆæƒæ—¥å¿—ï¼‰
  - MongoDB: æµ·é‡æ—¥å¿—å­˜å‚¨ï¼ˆæˆæƒè®°å½•åˆ†æï¼‰

  è¿™ä¸ªæ¶æ„å›¾æ¸…æ™°åœ°å±•ç°äº†IAMç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹å’ŒæŠ€æœ¯æ¶æ„è®¾è®¡ã€‚


# é¡¹ç›®æŠ€æœ¯æ¶æ„å›¾

```mermaid
graph TB
    %% å®šä¹‰æ ·å¼ç±»
    classDef presentation fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef gateway fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef service fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef middleware fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef storage fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef framework fill:#f1f8e9,stroke:#689f38,stroke-width:2px

    %% è¡¨ç°å±‚
    subgraph PL ["è¡¨ç°å±‚ Presentation Layer"]
        WEB["Web Console<br/>Vue.js + Element UI"]:::presentation
        CLI["iamctl CLI<br/>Cobra + Viper"]:::presentation
        SDK["Go SDK<br/>marmotedu-sdk-go"]:::presentation
        APP["Third Party Apps<br/>RESTful Client"]:::presentation
    end

    %% APIç½‘å…³å±‚
    subgraph GL ["APIç½‘å…³å±‚ Gateway Layer"]
        LB["Load Balancer<br/>Nginx/HAProxy"]:::gateway
        CORS["CORS Middleware"]:::middleware
        AUTH["Auth Middleware<br/>JWT + Basic"]:::middleware
        LIMIT["Rate Limiter<br/>Token Bucket"]:::middleware
        LOG["Request Logger<br/>Zap + Context"]:::middleware
    end

    %% ä¸šåŠ¡æœåŠ¡å±‚
    subgraph SL ["ä¸šåŠ¡æœåŠ¡å±‚ Service Layer"]
        subgraph AS ["API Server"]
            API["iam-apiserver<br/>Gin + RESTful"]:::service
            GRPC["gRPC Server<br/>Protocol Buffers"]:::service
        end
        
        subgraph AuthS ["Auth Server"]
            AUTHZ["iam-authz-server<br/>Authorization Engine"]:::service
            POLICY["Policy Engine<br/>Ladon RBAC"]:::service
        end
        
        subgraph DP ["Data Processing"]
            PUMP["iam-pump<br/>Log Analytics"]:::service
            WATCHER["iam-watcher<br/>Cron Jobs"]:::service
        end
    end

    %% æ¡†æ¶å±‚
    subgraph FL ["æ¡†æ¶å±‚ Framework Layer"]
        GIN["Gin Framework<br/>HTTP Router"]:::framework
        GORM["GORM<br/>ORM Mapping"]:::framework
        REDIS_CLI["Redis Client<br/>go-redis/v8"]:::framework
        MONGO_CLI["MongoDB Driver<br/>mongo-go-driver"]:::framework
        ETCD_CLI["ETCD Client<br/>clientv3"]:::framework
    end

    %% å­˜å‚¨å±‚
    subgraph STL ["å­˜å‚¨å±‚ Storage Layer"]
        MYSQL[("MySQL/MariaDB<br/>Master + Slaves<br/>Users Secrets Policies")]:::storage
        REDIS[("Redis Cluster<br/>Cache + Session<br/>Policy Cache Auth Logs")]:::storage
        MONGO[("MongoDB<br/>Sharded Cluster<br/>Analytics Logs")]:::storage
        ETCD[("ETCD Cluster<br/>Configuration<br/>Service Discovery")]:::storage
    end

    %% ç›‘æ§è¿ç»´å±‚
    subgraph OL ["è¿ç»´å±‚ Operations Layer"]
        PROM["Prometheus<br/>Metrics Collection"]:::middleware
        JAEGER["Jaeger<br/>Distributed Tracing"]:::middleware
        ELK["ELK Stack<br/>Log Aggregation"]:::middleware
        GRAFANA["Grafana<br/>Monitoring Dashboard"]:::middleware
    end

    %% è¿æ¥å…³ç³»
    %% è¡¨ç°å±‚åˆ°ç½‘å…³å±‚
    WEB --> LB
    CLI --> AUTH
    SDK --> AUTH
    APP --> LB

    %% ç½‘å…³å±‚å¤„ç†é“¾
    LB --> CORS
    CORS --> AUTH
    AUTH --> LIMIT
    LIMIT --> LOG

    %% ç½‘å…³å±‚åˆ°æœåŠ¡å±‚
    LOG --> API
    LOG --> AUTHZ

    %% æœåŠ¡å±‚å†…éƒ¨é€šä¿¡
    API --> GRPC
    AUTHZ --> POLICY
    API -.->|"gRPCåŒæ­¥ç­–ç•¥"| AUTHZ
    PUMP --> WATCHER

    %% æœåŠ¡å±‚åˆ°æ¡†æ¶å±‚
    API --> GIN
    API --> GORM
    AUTHZ --> REDIS_CLI
    PUMP --> MONGO_CLI
    WATCHER --> ETCD_CLI

    %% æ¡†æ¶å±‚åˆ°å­˜å‚¨å±‚
    GORM --> MYSQL
    REDIS_CLI --> REDIS
    MONGO_CLI --> MONGO
    ETCD_CLI --> ETCD

    %% ç›‘æ§è¿æ¥
    API -.->|"Metrics"| PROM
    AUTHZ -.->|"Traces"| JAEGER
    PUMP -.->|"Logs"| ELK
    PROM --> GRAFANA
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è¯´æ˜

### åˆ†å±‚æ¶æ„è®¾è®¡

#### 1ï¸âƒ£ è¡¨ç°å±‚ (Presentation Layer)
| ç»„ä»¶ | æŠ€æœ¯æ ˆ | èŒè´£ |
|------|-------|------|
| **Web Console** | Vue.js + Element UI | ç®¡ç†ç•Œé¢ï¼Œç”¨æˆ·å‹å¥½çš„æ“ä½œç•Œé¢ |
| **iamctl CLI** | Cobra + Viper | å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿ç»´å’Œç®¡ç†æ“ä½œ |
| **Go SDK** | marmotedu-sdk-go | å¼€å‘è€…é›†æˆåŒ…ï¼Œç®€åŒ–APIè°ƒç”¨ |
| **Third Party Apps** | RESTful Client | ç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥ |

#### 2ï¸âƒ£ APIç½‘å…³å±‚ (Gateway Layer)
```go
// ä¸­é—´ä»¶å¤„ç†é“¾
Request â†’ Load Balancer â†’ CORS â†’ Auth â†’ Rate Limit â†’ Logger â†’ Service
```

| ä¸­é—´ä»¶ | åŠŸèƒ½ | æŠ€æœ¯å®ç° |
|-------|------|---------|
| **è´Ÿè½½å‡è¡¡** | è¯·æ±‚åˆ†å‘ã€å¥åº·æ£€æŸ¥ | Nginx/HAProxy |
| **è®¤è¯æˆæƒ** | JWTéªŒè¯ã€Basic Auth | gin-jwt/v2 |
| **é™æµæ§åˆ¶** | Token Bucketç®—æ³• | golang.org/x/time/rate |
| **è¯·æ±‚æ—¥å¿—** | ç»“æ„åŒ–æ—¥å¿—è®°å½• | Zap + Context |

#### 3ï¸âƒ£ ä¸šåŠ¡æœåŠ¡å±‚ (Service Layer)

**iam-apiserver æ ¸å¿ƒæ¨¡å—**
```go
// ä»£ç ç»“æ„
internal/apiserver/
â”œâ”€â”€ controller/v1/    # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ user/        # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ secret/      # å¯†é’¥ç®¡ç†  
â”‚   â””â”€â”€ policy/      # ç­–ç•¥ç®¡ç†
â”œâ”€â”€ service/v1/      # ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ store/           # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ mysql/       # MySQLå®ç°
â”‚   â”œâ”€â”€ etcd/        # ETCDå®ç°
â”‚   â””â”€â”€ fake/        # æµ‹è¯•å®ç°
â””â”€â”€ options/         # é…ç½®é€‰é¡¹
```

**iam-authz-server æˆæƒå¼•æ“**
```go
// æˆæƒæµç¨‹
Request â†’ JWTéªŒè¯ â†’ ç­–ç•¥åŒ¹é… â†’ æƒé™åˆ¤æ–­ â†’ å®¡è®¡æ—¥å¿— â†’ Response
```

#### 4ï¸âƒ£ æ¡†æ¶å±‚ (Framework Layer)
| æ¡†æ¶/åº“ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|------|------|
| **Gin** | v1.7.4 | HTTPè·¯ç”±å’Œä¸­é—´ä»¶ |
| **GORM** | v1.22.4 | ORMæ•°æ®åº“æ“ä½œ |
| **go-redis** | v8.11.4 | Rediså®¢æˆ·ç«¯ |
| **mongo-driver** | å®˜æ–¹é©±åŠ¨ | MongoDBæ“ä½œ |
| **etcd/clientv3** | v3.5.0 | é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ |

#### 5ï¸âƒ£ å­˜å‚¨å±‚ (Storage Layer)

**æ•°æ®åˆ†å±‚å­˜å‚¨ç­–ç•¥**
```mermaid
graph LR
    A[å®æ—¶è¯·æ±‚] --> B[Redisç¼“å­˜]
    B --> C[MySQLä¸»åº“]
    C --> D[MySQLä»åº“]
    E[æ‰¹é‡åˆ†æ] --> F[MongoDB]
    G[é…ç½®ç®¡ç†] --> H[ETCDé›†ç¾¤]
```

| å­˜å‚¨ | ç”¨é€” | ç‰¹æ€§ |
|------|------|------|
| **MySQL** | ä¸»æ•°æ®å­˜å‚¨ | ACIDäº‹åŠ¡ã€ä¸»ä»å¤åˆ¶ |
| **Redis** | ç¼“å­˜+ä¼šè¯ | é«˜æ€§èƒ½ã€æŒä¹…åŒ– |
| **MongoDB** | æ—¥å¿—åˆ†æ | åˆ†ç‰‡é›†ç¾¤ã€çµæ´»æ–‡æ¡£ |
| **ETCD** | é…ç½®ä¸­å¿ƒ | å¼ºä¸€è‡´æ€§ã€æœåŠ¡å‘ç° |

#### 6ï¸âƒ£ è¿ç»´å±‚ (Operations Layer)

**å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±**
- **Metrics**: Prometheusæ”¶é›†æ€§èƒ½æŒ‡æ ‡
- **Tracing**: Jaegeråˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª  
- **Logging**: ELK Stackæ—¥å¿—èšåˆåˆ†æ

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

#### é«˜å¯ç”¨è®¾è®¡
- **æ— çŠ¶æ€æœåŠ¡**: æœåŠ¡å®ä¾‹å¯æ°´å¹³æ‰©å±•
- **æ•°æ®åº“é›†ç¾¤**: ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»
- **ç¼“å­˜é›†ç¾¤**: Redis Clusteræ¨¡å¼
- **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹å¥åº·æ£€æŸ¥

#### é«˜æ€§èƒ½ä¼˜åŒ–
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥å¤ç”¨
- **ç¼“å­˜ç­–ç•¥**: å¤šçº§ç¼“å­˜ï¼ˆæœ¬åœ°+åˆ†å¸ƒå¼ï¼‰
- **å¼‚æ­¥å¤„ç†**: æ—¥å¿—å’Œç»Ÿè®¡ä»»åŠ¡è§£è€¦
- **æ‰¹é‡æ“ä½œ**: å‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°

#### å®‰å…¨æ€§ä¿éšœ
- **è®¤è¯æœºåˆ¶**: JWT + Basic AuthåŒé‡è®¤è¯
- **æƒé™æ§åˆ¶**: RBACç»†ç²’åº¦æˆæƒ
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®AESåŠ å¯†å­˜å‚¨
- **å®‰å…¨å®¡è®¡**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è¿½è¸ª

è¿™ä¸ªæŠ€æœ¯æ¶æ„å›¾å±•ç°äº†IAMç³»ç»Ÿå®Œæ•´çš„æŠ€æœ¯æ ˆå’Œåˆ†å±‚è®¾è®¡ï¼Œæ˜¯å­¦ä¹ ä¼ä¸šçº§Goé¡¹ç›®æ¶æ„çš„ä¼˜ç§€èŒƒä¾‹ã€‚

## ğŸŠâ€â™€ï¸ IAMä¸šåŠ¡æµç¨‹æ³³é“å›¾

```mermaid
flowchart TD
      subgraph "ç”¨æˆ·æ³³é“"
          A[ç”¨æˆ·ç™»å½•] --> B[é€‰æ‹©åŠŸèƒ½]
          B --> C[æäº¤è¯·æ±‚]
      end

      subgraph "ç³»ç»Ÿæ³³é“"
          D[éªŒè¯èº«ä»½] --> E[å¤„ç†è¯·æ±‚]
          E --> F[è¿”å›ç»“æœ]
      end

      subgraph "æ•°æ®åº“æ³³é“"
          G[æŸ¥è¯¢æ•°æ®] --> H[æ›´æ–°è®°å½•]
      end

      A --> D
      C --> E
      E --> G
      F --> C
```

### ç”¨æˆ·è®¤è¯æˆæƒæµç¨‹

```mermaid
flowchart TD
    subgraph UL ["ç”¨æˆ·/åº”ç”¨å±‚"]
        A1[ç”¨æˆ·ç™»å½•] --> A2[è·å–JWT Token] 
        A2 --> A3[æºå¸¦Tokenè¯·æ±‚èµ„æº]
        A3 --> A4[æ¥æ”¶æˆæƒç»“æœ]
    end
    
    subgraph GL ["APIç½‘å…³å±‚"]
        B1[æ¥æ”¶ç™»å½•è¯·æ±‚] --> B2[è½¬å‘åˆ°APIæœåŠ¡å™¨]
        B3[æ¥æ”¶Tokenè¯·æ±‚] --> B4[éªŒè¯Tokenæ ¼å¼]
        B4 --> B5[è½¬å‘æˆæƒè¯·æ±‚]
        B6[è¿”å›æˆæƒç»“æœ] --> B7[å“åº”ç»™ç”¨æˆ·]
    end
    
    subgraph AS ["iam-apiserverå±‚"]
        C1[éªŒè¯ç”¨æˆ·å‡­æ®] --> C2[æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯]
        C2 --> C3[ç”ŸæˆJWT Token]
        C4[åŒæ­¥ç­–ç•¥åˆ°æˆæƒæœåŠ¡å™¨] --> C5[è®°å½•æ“ä½œæ—¥å¿—]
    end
    
    subgraph AuthS ["iam-authz-serverå±‚"]
        D1[æ¥æ”¶æˆæƒè¯·æ±‚] --> D2[è§£æJWT Token]
        D2 --> D3[æŸ¥è¯¢ç­–ç•¥ç¼“å­˜]
        D3 --> D4[æ‰§è¡Œæƒé™åˆ¤æ–­]
        D4 --> D5[è®°å½•æˆæƒæ—¥å¿—]
        D5 --> D6[è¿”å›æˆæƒç»“æœ]
    end
    
    subgraph SL ["æ•°æ®å­˜å‚¨å±‚"]
        E1[MySQL: ç”¨æˆ·è®¤è¯] 
        E2[Redis: ç­–ç•¥ç¼“å­˜]
        E3[Redis: æˆæƒæ—¥å¿—]
        E4[MongoDB: æŒä¹…åŒ–æ—¥å¿—]
    end
    
    subgraph PL ["æ•°æ®å¤„ç†å±‚"]
        F1[iam-pump: æ‹‰å–æ—¥å¿—] --> F2[æ•°æ®åˆ†æå¤„ç†]
        F2 --> F3[å­˜å‚¨åˆ°MongoDB]
        G1[iam-watcher: å®šæ—¶æ¸…ç†] --> G2[ç”¨æˆ·çŠ¶æ€æ£€æŸ¥]
    end

    %% ä¸»è¦æµç¨‹è¿æ¥
    A1 --> B1
    B2 --> C1
    C2 --> E1
    C3 --> A2
    C4 --> E2
    
    A3 --> B3
    B5 --> D1
    D3 --> E2
    D5 --> E3
    D6 --> B6
    B7 --> A4
    
    %% å¼‚æ­¥å¤„ç†è¿æ¥
    E3 -.-> F1
    F3 --> E4
    E1 -.-> G1
    
    %% æ ·å¼å®šä¹‰
    classDef userLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef gatewayLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef serviceLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef storageLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef processLayer fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class A1,A2,A3,A4 userLayer
    class B1,B2,B3,B4,B5,B6,B7 gatewayLayer
    class C1,C2,C3,C4,C5,D1,D2,D3,D4,D5,D6 serviceLayer
    class E1,E2,E3,E4 storageLayer
    class F1,F2,F3,G1,G2 processLayer
```

### ğŸ”„ æµç¨‹è¯´æ˜

#### è®¤è¯æµç¨‹ (Authentication Flow)
1. **ç”¨æˆ·ç™»å½•** â†’ APIç½‘å…³ â†’ iam-apiserver
2. **éªŒè¯å‡­æ®** â†’ æŸ¥è¯¢MySQLç”¨æˆ·æ•°æ®
3. **ç”ŸæˆJWT** â†’ è¿”å›ç»™ç”¨æˆ·
4. **ç­–ç•¥åŒæ­¥** â†’ æ¨é€åˆ°iam-authz-serverç¼“å­˜

#### æˆæƒæµç¨‹ (Authorization Flow)  
1. **æºå¸¦Tokenè¯·æ±‚èµ„æº** â†’ APIç½‘å…³éªŒè¯
2. **è½¬å‘æˆæƒè¯·æ±‚** â†’ iam-authz-server
3. **JWTè§£æéªŒè¯** â†’ æŸ¥è¯¢Redisç­–ç•¥ç¼“å­˜
4. **æƒé™åˆ¤æ–­** â†’ è¿”å›æˆæƒç»“æœ
5. **è®°å½•æ—¥å¿—** â†’ å­˜å‚¨åˆ°Redis

#### å¼‚æ­¥å¤„ç†æµç¨‹ (Async Processing)
1. **iam-pump** â†’ ä»Redisæ‹‰å–æˆæƒæ—¥å¿—
2. **æ•°æ®åˆ†æ** â†’ å­˜å‚¨åˆ°MongoDB
3. **iam-watcher** â†’ å®šæ—¶æ¸…ç†è¿‡æœŸæ•°æ®

### æ³³é“å›¾ç‰¹ç‚¹
- **æ¸…æ™°åˆ†å±‚**: æ¯ä¸ªæ³³é“ä»£è¡¨ä¸åŒçš„ç³»ç»Ÿå±‚æ¬¡
- **æµç¨‹å¯è§†**: ç›´è§‚å±•ç°æ•°æ®æµå‘å’Œå¤„ç†æ­¥éª¤  
- **å¼‚æ­¥å¤„ç†**: è™šçº¿è¡¨ç¤ºå¼‚æ­¥æ“ä½œ
- **é¢œè‰²åŒºåˆ†**: ä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒç³»ç»Ÿç»„ä»¶

## ğŸ¯ å…¶ä»–ä¸šåŠ¡æµç¨‹æ³³é“å›¾

### ç”¨æˆ·ç®¡ç†æµç¨‹

```mermaid
flowchart TD
    subgraph ADMIN ["ç®¡ç†å‘˜"]
        M1[åˆ›å»ºç”¨æˆ·] --> M2[åˆ†é…è§’è‰²] 
        M2 --> M3[è®¾ç½®æƒé™ç­–ç•¥]
    end
    
    subgraph SERVER ["iam-apiserver"]
        S1[éªŒè¯ç®¡ç†å‘˜æƒé™] --> S2[åˆ›å»ºç”¨æˆ·è®°å½•]
        S2 --> S3[ç”Ÿæˆé»˜è®¤å¯†é’¥] 
        S3 --> S4[å…³è”æƒé™ç­–ç•¥]
    end
    
    subgraph DB ["æ•°æ®åº“"]
        D1[ä¿å­˜ç”¨æˆ·ä¿¡æ¯]
        D2[ä¿å­˜è§’è‰²å…³è”]
        D3[ä¿å­˜æƒé™ç­–ç•¥]
    end
    
    M1 --> S1
    S2 --> D1
    S3 --> D2  
    S4 --> D3
    
    classDef admin fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef server fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef database fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    
    class M1,M2,M3 admin
    class S1,S2,S3,S4 server
    class D1,D2,D3 database
```

è¿™æ ·çš„æ³³é“å›¾æ¸…æ™°åœ°å±•ç°äº†IAMç³»ç»Ÿä¸­ä¸åŒè§’è‰²å’Œç»„ä»¶ä¹‹é—´çš„äº¤äº’æµç¨‹ï¼Œéå¸¸é€‚åˆç³»ç»Ÿè®¾è®¡æ–‡æ¡£å’ŒæŠ€æœ¯äº¤æµã€‚

# ä¸šåŠ¡æ¨¡å—
IAMé¡¹ç›®ä»£ç ç»“æ„ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡¹ç›®ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸šåŠ¡æ¨¡å—ï¼š

  3ä¸ªæ ¸å¿ƒä¸šåŠ¡æ¨¡å—

  1. Userï¼ˆç”¨æˆ·ç®¡ç†ï¼‰ - ç”¨æˆ·çš„åˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢ã€å¯†ç ä¿®æ”¹ç­‰åŠŸèƒ½
  2. Policyï¼ˆç­–ç•¥ç®¡ç†ï¼‰ - æƒé™ç­–ç•¥çš„åˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢ç­‰åŠŸèƒ½
  3. Secretï¼ˆå¯†é’¥ç®¡ç†ï¼‰ - APIå¯†é’¥çš„åˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢ç­‰åŠŸèƒ½

  4ä¸ªç³»ç»ŸæœåŠ¡æ¨¡å—

  1. iam-apiserver - APIæœåŠ¡å™¨ï¼Œæä¾›REST APIæ¥å£
  2. iam-authz-server - æˆæƒæœåŠ¡å™¨ï¼Œå¤„ç†æˆæƒé€»è¾‘
  3. iam-pump - æ•°æ®æ³µæœåŠ¡ï¼Œè´Ÿè´£æ•°æ®åˆ†æå’Œå¯¼å‡º
  4. iam-watcher - ç›‘æ§æœåŠ¡ï¼Œè´Ÿè´£ç³»ç»Ÿç›‘æ§å’Œæ¸…ç†ä»»åŠ¡

  1ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¨¡å—

  1. iamctl - å‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œç”¨äºç®¡ç†IAMç³»ç»Ÿ

  æ€»å…±æœ‰8ä¸ªæ¨¡å—ï¼Œå…¶ä¸­3ä¸ªæ˜¯æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼Œ4ä¸ªæ˜¯ç³»ç»ŸæœåŠ¡æ¨¡å—ï¼Œ1ä¸ªæ˜¯å®¢æˆ·ç«¯
  å·¥å…·æ¨¡å—ã€‚


# ä¸šåŠ¡æ¨¡å—æ³³é“å›¾

1. Useræ¨¡å—ä¸šåŠ¡æ³³é“å›¾

```mermaid
graph TB
      subgraph "Useræ¨¡å—ä¸šåŠ¡æµç¨‹"
          subgraph "Client"
              A1[å‘èµ·è¯·æ±‚]
              A2[æ¥æ”¶å“åº”]
          end

          subgraph "Controllerå±‚"
              B1[è¯·æ±‚å‚æ•°ç»‘å®š]
              B2[å‚æ•°éªŒè¯]
              B3[å¯†ç åŠ å¯†]
              B4[è°ƒç”¨Serviceå±‚]
              B5[è¿”å›å“åº”]
          end

          subgraph "Serviceå±‚"
              C1[ä¸šåŠ¡é€»è¾‘å¤„ç†]
              C2[é‡å¤æ€§æ£€æŸ¥]
              C3[å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–]
              C4[è°ƒç”¨Storeå±‚]
          end

          subgraph "Storeå±‚"
              D1[æ•°æ®åº“æ“ä½œ]
              D2[MySQLå­˜å‚¨]
              D3[è¿”å›ç»“æœ]
          end

          subgraph "ä¸šåŠ¡æ“ä½œç±»å‹"
              E1[åˆ›å»ºç”¨æˆ·<br/>Create]
              E2[æŸ¥è¯¢ç”¨æˆ·<br/>Get/List]
              E3[æ›´æ–°ç”¨æˆ·<br/>Update]
              E4[åˆ é™¤ç”¨æˆ·<br/>Delete]
              E5[ä¿®æ”¹å¯†ç <br/>ChangePassword]
          end
      end

      A1 --> B1
      B1 --> B2
      B2 --> B3
      B3 --> B4
      B4 --> C1
      C1 --> C2
      C2 --> C3
      C3 --> C4
      C4 --> D1
      D1 --> D2
      D2 --> D3
      D3 --> C4
      C4 --> B4
      B4 --> B5
      B5 --> A2
```

âº 2. Policyæ¨¡å—ä¸šåŠ¡æ³³é“å›¾

```mermaid

graph TB
      subgraph "Policyæ¨¡å—ä¸šåŠ¡æµç¨‹"
          subgraph "Client"
              A1[å‘èµ·ç­–ç•¥è¯·æ±‚]
              A2[æ¥æ”¶ç­–ç•¥å“åº”]
          end

          subgraph "Controllerå±‚"
              B1[è¯·æ±‚å‚æ•°è§£æ]
              B2[æƒé™è®¤è¯æ£€æŸ¥]
              B3[å‚æ•°éªŒè¯]
              B4[è°ƒç”¨Serviceå±‚]
              B5[å‘å¸ƒä¸­é—´ä»¶å¤„ç†]
              B6[è¿”å›å“åº”]
          end

          subgraph "Serviceå±‚"
              C1[ç­–ç•¥ä¸šåŠ¡é€»è¾‘]
              C2[ç”¨æˆ·æƒé™æ£€æŸ¥]
              C3[ç­–ç•¥å…³è”éªŒè¯]
              C4[è°ƒç”¨Storeå±‚]
          end

          subgraph "Storeå±‚"
              D1[ç­–ç•¥æ•°æ®æ“ä½œ]
              D2[MySQLå­˜å‚¨]
              D3[æŒ‰ç”¨æˆ·æŸ¥è¯¢]
              D4[è¿”å›ç»“æœ]
          end

          subgraph "Authorization Server"
              E1[ç­–ç•¥æˆæƒéªŒè¯]
              E2[æƒé™ç¼“å­˜æ›´æ–°]
              E3[ç­–ç•¥ç”Ÿæ•ˆé€šçŸ¥]
          end

          subgraph "ä¸šåŠ¡æ“ä½œç±»å‹"
              F1[åˆ›å»ºç­–ç•¥<br/>Create]
              F2[æŸ¥è¯¢ç­–ç•¥<br/>Get/List]
              F3[æ›´æ–°ç­–ç•¥<br/>Update]
              F4[åˆ é™¤ç­–ç•¥<br/>Delete/DeleteCollection]
          end
      end

      A1 --> B1
      B1 --> B2
      B2 --> B3
      B3 --> B4
      B4 --> C1
      C1 --> C2
      C2 --> C3
      C3 --> C4
      C4 --> D1
      D1 --> D2
      D2 --> D3
      D3 --> D4
      D4 --> C4
      C4 --> B4
      B4 --> B5
      B5 --> E1
      E1 --> E2
      E2 --> E3
      E3 --> B5
      B5 --> B6
      B6 --> A2
```

âº 3. Secretæ¨¡å—ä¸šåŠ¡æ³³é“å›¾

```mermaid

graph TB
      subgraph "Secretæ¨¡å—ä¸šåŠ¡æµç¨‹"
          subgraph "Client"
              A1[å‘èµ·å¯†é’¥è¯·æ±‚]
              A2[æ¥æ”¶å¯†é’¥å“åº”]
          end

          subgraph "Controllerå±‚"
              B1[è¯·æ±‚å‚æ•°ç»‘å®š]
              B2[JWTè®¤è¯éªŒè¯]
              B3[å‚æ•°æ ¡éªŒ]
              B4[è°ƒç”¨Serviceå±‚]
              B5[å‘å¸ƒä¸­é—´ä»¶]
              B6[å“åº”å¤„ç†]
          end

          subgraph "Serviceå±‚"
              C1[å¯†é’¥ä¸šåŠ¡é€»è¾‘]
              C2[ç”¨æˆ·æƒé™éªŒè¯]
              C3[å¯†é’¥å”¯ä¸€æ€§æ£€æŸ¥]
              C4[è°ƒç”¨Storeå±‚]
          end

          subgraph "Storeå±‚"
              D1[å¯†é’¥æ•°æ®æ“ä½œ]
              D2[MySQLå­˜å‚¨]
              D3[æŒ‰ç”¨æˆ·è¿‡æ»¤]
              D4[è¿”å›ç»“æœ]
          end

          subgraph "Authorization Server"
              E1[å¯†é’¥æƒé™æ ¡éªŒ]
              E2[APIè®¿é—®æ§åˆ¶]
              E3[å¯†é’¥çŠ¶æ€åŒæ­¥]
          end

          subgraph "ä¸šåŠ¡æ“ä½œç±»å‹"
              F1[åˆ›å»ºå¯†é’¥<br/>Create]
              F2[æŸ¥è¯¢å¯†é’¥<br/>Get/List]
              F3[æ›´æ–°å¯†é’¥<br/>Update]
              F4[åˆ é™¤å¯†é’¥<br/>Delete]
          end
      end

      A1 --> B1
      B1 --> B2
      B2 --> B3
      B3 --> B4
      B4 --> C1
      C1 --> C2
      C2 --> C3
      C3 --> C4
      C4 --> D1
      D1 --> D2
      D2 --> D3
      D3 --> D4
      D4 --> C4
      C4 --> B4
      B4 --> B5
      B5 --> E1
      E1 --> E2
      E2 --> E3
      E3 --> B5
      B5 --> B6
      B6 --> A2
```

âº ä»¥ä¸Šå°±æ˜¯IAMé¡¹ç›®ä¸‰ä¸ªæ ¸å¿ƒä¸šåŠ¡æ¨¡å—çš„ä¸šåŠ¡æ³³é“å›¾ï¼š

  1. Useræ¨¡å—ï¼šè´Ÿè´£ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤å’Œå¯†ç ä¿®æ”¹
  2. Policyæ¨¡å—ï¼šè´Ÿè´£æƒé™ç­–ç•¥ç®¡ç†ï¼Œä¸æˆæƒæœåŠ¡å™¨åè°ƒå¤„ç†æƒé™æ§åˆ¶
  3. Secretæ¨¡å—ï¼šè´Ÿè´£APIå¯†é’¥ç®¡ç†ï¼Œä¸ºAPIè®¿é—®æä¾›å®‰å…¨è®¤è¯

  æ¯ä¸ªæ¨¡å—éƒ½éµå¾ªControllerâ†’Serviceâ†’Storeçš„ä¸‰å±‚æ¶æ„ï¼Œå¹¶ä¸Authorization
  Serverè¿›è¡Œæƒé™éªŒè¯å’ŒçŠ¶æ€åŒæ­¥ã€‚